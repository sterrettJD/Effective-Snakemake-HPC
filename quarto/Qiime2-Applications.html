<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Effective Snakemake on Computer Clusters - Qiime2 Applications</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Effective Snakemake on Computer Clusters</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-snakemake-basics" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Snakemake Basics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-snakemake-basics">    
        <li>
    <a class="dropdown-item" href="../quarto/About-Snakemake.html" rel="" target="">
 <span class="dropdown-text">About Snakemake</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quarto/Snakemake-Essentials.html" rel="" target="">
 <span class="dropdown-text">Snakemake Essentials</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more-snakemake" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">More Snakemake</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-more-snakemake">    
        <li>
    <a class="dropdown-item" href="../quarto/Elaborating-rules.html" rel="" target="">
 <span class="dropdown-text">Elaborating rules</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quarto/Config-files.html" rel="" target="">
 <span class="dropdown-text">Using Config Files</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cluster-integration" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Cluster Integration</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cluster-integration">    
        <li>
    <a class="dropdown-item" href="../quarto/Cluster-friendly-Snakemake.html" rel="" target="">
 <span class="dropdown-text">Cluster-friendly Snakemake</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-applications" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Applications</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-applications">    
        <li>
    <a class="dropdown-item" href="../quarto/Qiime2-Applications.html" rel="" target="">
 <span class="dropdown-text">Qiime2 Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quarto/Using-R-with-Snakemake.html" rel="" target="">
 <span class="dropdown-text">Using R with Snakemake</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-qiime2-and-snakemake-to-work-together" id="toc-getting-qiime2-and-snakemake-to-work-together" class="nav-link active" data-scroll-target="#getting-qiime2-and-snakemake-to-work-together">Getting Qiime2 and Snakemake to work together</a></li>
  <li><a href="#example-workflow" id="toc-example-workflow" class="nav-link" data-scroll-target="#example-workflow">Example workflow</a></li>
  <li><a href="#oh-no-someone-is-unhappy-what-do-i-do" id="toc-oh-no-someone-is-unhappy-what-do-i-do" class="nav-link" data-scroll-target="#oh-no-someone-is-unhappy-what-do-i-do">Oh no! Someone is unhappy, what do I do?</a>
  <ul class="collapse">
  <li><a href="#things-ive-had-to-learn-the-hard-way" id="toc-things-ive-had-to-learn-the-hard-way" class="nav-link" data-scroll-target="#things-ive-had-to-learn-the-hard-way">Things I’ve had to learn the hard way:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Qiime2 Applications</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="getting-qiime2-and-snakemake-to-work-together" class="level1">
<h1>Getting Qiime2 and Snakemake to work together</h1>
<p>Firstly, let’s make sure that you have <code>conda</code>, <code>mamba-forge</code>, and Qiime2 installed. Follow the installation instructions for the operating system of your local computer (or wherever you want to install Qiime2) which can be found <a href="https://docs.qiime2.org/2023.5/install/native/">here</a>.</p>
<p>Once you have Qiime2 installed, activate your Qiime2 environment by running <code>conda activate qiime2-2023.5</code> before running:</p>
<pre><code>pip install snakemake</code></pre>
<p>You now have Snakemake installed in your Qiime2 environment and can start working on your pipeline!</p>
</section>
<section id="example-workflow" class="level1">
<h1>Example workflow</h1>
<pre class="snakemake"><code>rule all:
    input:
        "test_seqs.fasta",
        "databases/sepp-refs-silva-128.qza",
        "databases/silva-138-99-515-806-nb-classifier.qza",
        "merged_table.qza"


rule convert_to_fasta:
    input:
        "test_seqs.qza"
    output:
        "test_seqs.fasta"
    conda:
        # you need to reference your installed Qiime2 environment
        # or you can activate that environment before calling snakemake 
        # and you don't have to reference it here 
        "qiime2-2023.5"
    shell:
        """
        qiime tools export \
            --input-path {input} \
            --output-path ./ # this puts the output file in your current working directory
        
        mv dna-sequences.fasta {output}
        """ 

# you can reference online classifiers via wget 
# so you don't need to have them downloaded already
rule get_reference_databases:
    output:
        "databases/sepp-refs-silva-128.qza",
        "databases/silva-138-99-515-806-nb-classifier.qza"
    shell:
        """
        mkdir -p ./databases/ # make the directory if it doesn't exist, otherwise does nothing 
        wget https://data.qiime2.org/2023.5/common/sepp-refs-silva-128.qza -P ./databases/
        wget https://data.qiime2.org/2023.5/common/silva-138-99-515-806-nb-classifier.qza -P ./databases/
        """

rule merge_tables:
    input:
        table1="table1.qza",
        table2="table2.qza"
    output:
        merged_table="merged_table.qza"
    conda:
        "qiime2-2023.5"
    shell:
        """
        qiime feature-table merge \
            --i-tables {input.table1} \
            --i-tables {input.table2} \
            --o-merged-table {output.merged_table}
        """</code></pre>
</section>
<section id="oh-no-someone-is-unhappy-what-do-i-do" class="level1">
<h1>Oh no! Someone is unhappy, what do I do?</h1>
<p>Both Qiime2 and Snakemake are notoriously known for being picky about the little things (i.e.&nbsp;did you have an extra space that you forgot about after one of your commands and now you have a really unhelpful error message?) and sometimes the combination of the two can be incredibly frustrating.</p>
<section id="things-ive-had-to-learn-the-hard-way" class="level2">
<h2 class="anchored" data-anchor-id="things-ive-had-to-learn-the-hard-way">Things I’ve had to learn the hard way:</h2>
<p><strong>1. Anytime you call a Qiime2 command that outputs a directory of files (like <code>qiime diversity core-metrics-phylogenetic</code>), Qiime and Snakemake get mad at each other because Snakemake creates the output directory before Qiime. Qiime will then give you an error about how the output directory already exists (because Snakemake created it first).</strong></p>
<p>Instead, you need to specify that the output you’re generating in your shell is an entire directory by using <code>output = directory("directory_name")</code>. For example:</p>
<pre class="snakemake"><code>rule all:
    input:
        # can reference output directory like so here
        "core_metrics_directory"


rule core_metrics_analysis:
    input:
        TREE="tree.qza",
        TABLE="taxonomy_filtered.qza",
        METADATA="metadata.tsv"
    output:
        OUTPUT_DIR=directory("core_metrics_directory")
    params:
        sampling_depth=10000
    shell:
        """
        qiime diversity core-metrics-phylogenetic \
            --i-phylogeny {input.TREE} \
            --i-table {input.TABLE} \
            --p-sampling-depth {params.sampling_depth} \
            --m-metadata-file {input.METADATA} \
            --output-dir {output} 
        """
</code></pre>
<p>I used to list every single output file that would be in that directory in the Qiime command itself instead of just the output directory. This also works but it get’s a bit annoying after a while, especially if the output directory being generated has file names that change with each run. For example:</p>
<pre class="snakemake"><code>rule core_metrics_analysis:
    input:
        TREE="tree.qza",
        TABLE="tax_filt_actual.qza",
        METADATA="metadata.tsv"
    output:
        BCDM="bray_curtis_distance_matrix.qza",
        BCEMP="bray_curtis_emperor.qzv",
        BCPCOA="bray_curtis_pcoa_results.qza",
        EVEN="evenness_vector.qza",
        FAITH="faith_pd_vector.qza",
        JDM="jaccard_distance_matrix.qza",
        JEMP="jaccard_emperor.qzv",
        JPCOA="jaccard_pcoa_results.qza",
        OF="observed_features_vector.qza",
        RAREFIED="rarefied_table.qza",
        SHANNON="shannon_vector.qza",
        UUDM="unweighted_unifrac_distance_matrix.qza",
        UUEMP="unweighted_unifrac_emperor.qzv",
        UUPCOA="unweighted_unifrac_pcoa_results.qza",
        WUDM="weighted_unifrac_distance_matrix.qza",
        WUEMP="weighted_unifrac_emperor.qzv",
        WUPCOA="weighted_unifrac_pcoa_results.qza"
    conda:
        "qiime2-2023.5"
    params:
        sampling_depth=10000
    shell:
        """
        qiime diversity core-metrics-phylogenetic \
            --i-phylogeny {input.TREE} \
            --i-table {input.TABLE} \
            --p-sampling-depth {params.sampling_depth} \
            --m-metadata-file {input.METADATA} \
            --o-rarefied-table {output.RAREFIED} \
            --o-faith-pd-vector {output.FAITH} \
            --o-observed-features-vector {output.OF} \
            --o-shannon-vector {output.SHANNON} \
            --o-evenness-vector {output.EVEN} \
            --o-unweighted-unifrac-distance-matrix {output.UUDM} \
            --o-weighted-unifrac-distance-matrix {output.WUDM} \
            --o-jaccard-distance-matrix {output.JDM} \
            --o-bray-curtis-distance-matrix {output.BCDM} \
            --o-unweighted-unifrac-pcoa-results {output.UUPCOA} \
            --o-weighted-unifrac-pcoa-results {output.WUPCOA} \
            --o-jaccard-pcoa-results {output.JPCOA} \
            --o-bray-curtis-pcoa-results {output.BCPCOA} \
            --o-unweighted-unifrac-emperor {output.UUEMP} \
            --o-weighted-unifrac-emperor {output.WUEMP} \
            --o-jaccard-emperor {output.JEMP} \
            --o-bray-curtis-emperor {output.BCEMP}
        """</code></pre>
<p><strong>2. Since many of the steps in a Qiime2 workflow are interactive, put each step in it’s own Snakemake rule.</strong></p>
<p>I originally thought that it would be more streamlined to put all of the Qiime2 workflow code into a regular bash script and to reference that in my Snakemake rules (it would certainly make my snakefile shorter). However, since many of the outputs in the Qiime2 workflow need to be referenced to inform the parameters on downstream steps, leaving each step in it’s own rule allows you to easily check generated outputs and adjust subsequent parameters. This is also particularly helpful when you need to re-run your workflow (as that inevitably happens) since Snakemake will only re-run rules that have been altered or are missing outputs so the super time-consuming Qiime2 steps will only be run once. If you had everything in a bash script, it would be re-run with your workflow every time, which is a lot of time and computational power that will slow down your analysis.</p>
<p><strong>3. Qiime2 doesn’t like to be referenced as a YAML file. Instead, you should follow the Qiime2 installation instructions on their website to use that environment in your snakefile.</strong></p>
<p>I had a really unfun time attempting to create my own Qiime2 <code>.yaml</code> file to reference in my snakefile. It seemed like no matter which approach I took (including the one suggested on the <a href="https://sterrettjd.github.io/Effective-Snakemake-HPC/quarto/Elaborating-rules.html#using-conda-environment-yaml-recommended">Elaborating Rules Page</a>), the <code>.yaml</code> file wouldn’t reference Qiime2 correctly. I ended up creating a <code>bash</code> script with the exact Qiime2 installation instructions in it and running that <code>bash</code> script before my workflow <a href="https://sterrettjd.github.io/Effective-Snakemake-HPC/quarto/Elaborating-rules.html#combining-use-of-conda-environment-name-and-yaml-files">like so</a>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>